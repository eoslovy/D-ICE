# Today I learned

`윤덕건`

배운거 정리하기

### 2025-04-22

- 기획 회의

### 2025-04-23

# 📘 TIL – Redis Cluster 정리

## 🔹 Redis Cluster란?
- Redis의 **수평 확장**을 지원하는 분산형 구조
- 데이터를 **여러 노드에 샤딩(분산 저장)**하여 대용량 처리 가능
- **고가용성(Failover)**, **자동 샤딩**, **분산처리** 제공

---

## 🔹 핵심 개념

| 개념           | 설명 |
|----------------|------|
| **해시 슬롯**   | 키는 CRC16 해시를 통해 0~16383 사이의 슬롯 중 하나에 매핑됨 |
| **마스터 노드** | 데이터를 저장하고 클라이언트 요청을 처리 |
| **슬레이브 노드** | 마스터의 복제본, 장애 발생 시 자동 승격 |
| **자동 샤딩**   | 클러스터가 키를 자동으로 노드에 분산 저장 |
| **Failover**   | 마스터 장애 발생 시, 슬레이브가 자동으로 마스터로 승격 |

---

## 🔹 기본 구성

- **최소 권장 노드 수: 6개**
  - 마스터 3개
  - 각 마스터당 슬레이브 1개씩
- 클라이언트는 **슬롯-노드 맵핑 정보를 가지고 있음**

---

## 🔹 장점

- 데이터 분산 → 메모리 한계 극복
- 노드 장애 대응 → 서비스 무중단 운영
- 클러스터 자체가 샤딩을 관리 → 애플리케이션 부담 ↓

---

## 🔹 단점 및 제한 사항

- **멀티키 연산**은 같은 슬롯에 있을 때만 보장됨
- **Lua 스크립트**는 단일 노드에서만 실행됨
- 노드 간 **통신을 위한 네트워크 구성** 필요 (포트 16379 등 오픈 필요)

---

# ❓ 왜 Kafka, Redis는 기본 레플리카 수가 3?

## ✅ 핵심 이유 요약

### 1. 고가용성(High Availability)
- 노드 하나가 장애 나도 2개가 살아있어 서비스 유지 가능

### 2. 합의(Consensus) 구조에 적합
- 3개 중 2개 응답이면 다수결 합의 가능 → 안정적

### 3. 복제 비용 vs 안정성 균형
- 3개는 리소스 부담이 적으면서 장애 대응 능력도 뛰어남

---

## 🔸 관련 개념: Quorum(과반수 동의)

- 분산 시스템에서 다수의 동의가 필요할 때, 3개 중 2개 확보가 최소 요건
- Kafka ISR, Redis Sentinel 투표 로직 등에 활용됨

---

## 🎯 결론
> 3개 레플리카는 **속도, 안정성, 비용의 균형**을 가장 잘 맞춘 설정
